var MadMinuteUtlities={Range:function(e){this.range=e},populateClef:function(e,t,n){var r,i;switch(e){case"treble":r=n==="low"?MadMinute.$treble1:MadMinute.$treble2;i=MadMinuteUtlities.findModifiedRange(t,MadMinute.trebleRange.range);break;case"bass":r=n==="low"?MadMinute.$bass1:MadMinute.$bass2;i=MadMinuteUtlities.findModifiedRange(t,MadMinute.bassRange.range);break;case"tenor":r=n==="low"?MadMinute.$tenor1:MadMinute.$tenor2;i=MadMinuteUtlities.findModifiedRange(t,MadMinute.tenorRange.range);break;case"alto":r=n==="low"?MadMinute.$alto1:MadMinute.$alto2;i=MadMinuteUtlities.findModifiedRange(t,MadMinute.altoRange.range)}r.empty();$.each(i,function(e,t){r.append('<option value="'+t+'">'+t+"</option>")})},findActiveRanges:function(e){var t,n,r,i,s;t=MadMinute.$treble.hasClass("active")?1:0;n=MadMinute.$bass.hasClass("active")?1:0;r=MadMinute.$alto.hasClass("active")?1:0;i=MadMinute.$tenor.hasClass("active")?1:0;return s=[t,n,r,i]},findModifiedRange:function(e,t){var n;if(e==null)return n=t;for(var r=0;r<t.length;r++)if(t[r]===e){n=t.slice(r,t.length);return n}},getCount:function(){var e=$("#layout .layout-square").size(),t=0;for(var n=0;n<e;n++)$("#layout .layout-square").eq(n).hasClass("off")&&t++;return 60-t},getNote:function(e){var t=[],n,r,i,s;switch(e){case"treble":n=MadMinute.$treble1.val();r=MadMinute.$treble2.val();i=MadMinute.trebleRange.range.indexOf(n);s=MadMinute.trebleRange.range.indexOf(r);t=MadMinute.trebleRange.range.slice(i,s);break;case"bass":n=MadMinute.$bass1.val();r=MadMinute.$bass2.val();i=MadMinute.bassRange.range.indexOf(n);s=MadMinute.bassRange.range.indexOf(r);t=MadMinute.bassRange.range.slice(i,s);break;case"alto":n=MadMinute.$alto1.val();r=MadMinute.$alto2.val();i=MadMinute.altoRange.range.indexOf(n);s=MadMinute.altoRange.range.indexOf(r);t=MadMinute.altoRange.range.slice(i,s);break;case"tenor":n=MadMinute.$tenor1.val();r=MadMinute.$tenor2.val();i=MadMinute.tenorRange.range.indexOf(n);s=MadMinute.tenorRange.range.indexOf(r);t=MadMinute.tenorRange.range.slice(i,s)}return t[Math.floor(Math.random()*t.length)]},getKeys:function(){var e=[];for(var t=0;t<15;t++)$(".key-signature").eq(t).hasClass("active")&&e.push(MadMinute.allKeys[t]);return e}},MadMinute={init:function(){this.cacheElements();this.bindEvents();this.render()},cacheElements:function(){this.$create=$("#create");this.$treble=$("#treble-button");this.$bass=$("#bass-button");this.$tenor=$("#tenor-button");this.$alto=$("#alto-button");this.$trebleRange=$("#treble");this.$treble1=$("#treble-low");this.$treble2=$("#treble-high");this.$bass1=$("#bass-low");this.$bass2=$("#bass-high");this.$alto1=$("#alto-low");this.$alto2=$("#alto-high");this.$tenor1=$("#tenor-low");this.$tenor2=$("#tenor-high");this.$bassRange=$("#bass");this.$tenorRange=$("#tenor");this.$altoRange=$("#alto");this.$notes=$("#notes");this.$layout=$("#layout");this.$toggle=$("#toggle-all");this.$square=$(".layout-square");this.$count=$("#quiz-count");this.$print=$("#print-worksheet");this.$del=$("#delete-worksheet");this.allKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];this.keySignatures=[];this.pickedKeys=[];this.trebleRange=new MadMinuteUtlities.Range(["E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6"]);this.bassRange=new MadMinuteUtlities.Range(["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5"]);this.tenorRange=new MadMinuteUtlities.Range(["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B3","C4","D4","E4","F4","G4","A4","B4","C5"]);this.altoRange=new MadMinuteUtlities.Range(["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6"])},bindEvents:function(){this.$print.click(function(){window.print()});this.$del.click(function(){MadMinute.$notes.empty().hide();$("#controls").hide();$("#form, .tab-content").show()});this.$treble.click(function(){MadMinute.$trebleRange.toggle();MadMinuteUtlities.populateClef("treble",null,"low");MadMinuteUtlities.populateClef("treble",null,"high");if(MadMinute.$treble.hasClass("active")){$(".layout-square").removeClass("trebleShade").addClass("off");MadMinute.updateCount()}});this.$bass.click(function(){MadMinute.$bassRange.toggle();MadMinuteUtlities.populateClef("bass",null,"low");MadMinuteUtlities.populateClef("bass",null,"high");if(MadMinute.$bass.hasClass("active")){$(".layout-square").removeClass("bassShade").addClass("off");MadMinute.updateCount()}});this.$alto.click(function(){MadMinute.$altoRange.toggle();MadMinuteUtlities.populateClef("alto",null,"low");MadMinuteUtlities.populateClef("alto",null,"high");if(MadMinute.$alto.hasClass("active")){$(".layout-square").removeClass("altoShade").addClass("off");MadMinute.updateCount()}});this.$tenor.click(function(){MadMinute.$tenorRange.toggle();MadMinuteUtlities.populateClef("tenor",null,"low");MadMinuteUtlities.populateClef("tenor",null,"high");if(MadMinute.$tenor.hasClass("active")){$(".layout-square").removeClass("tenorShade").addClass("off");MadMinute.updateCount()}});this.$treble1.change(function(){MadMinuteUtlities.populateClef("treble",$(this).val(),"high")});this.$bass1.change(function(){MadMinuteUtlities.populateClef("bass",$(this).val(),"high")});this.$tenor1.change(function(){MadMinuteUtlities.populateClef("tenor",$(this).val(),"high")});this.$alto1.change(function(){MadMinuteUtlities.populateClef("alto",$(this).val(),"high")});this.$layout.on("click",this.$square,function(e){var t=$(e.target).attr("class").split(" "),n=t[1],r=MadMinuteUtlities.findActiveRanges(e),i=["off"];$.each(r,function(e,t){e==0&&t==1?i.push("trebleShade"):e==1&&t==1?i.push("bassShade"):e==2&&t==1?i.push("altoShade"):e==3&&t==1&&i.push("tenorShade")});var s=i.indexOf(n);if(n!="span7"){i.length>1?s+1==i.length?$(e.target).removeClass(n).addClass(i[0]):$(e.target).removeClass(n).addClass(i[s+1]):MadMinute.showError("<p>You need to select a clef before you change your layout!</p>");MadMinute.updateCount()}});this.$create.on("click",function(){var e=MadMinuteUtlities.getCount();e===0?MadMinute.showError("You need at least one note before you create a worksheet"):MadMinute.renderQuiz()})},updateCount:function(){var e=MadMinuteUtlities.getCount();this.$count.html(e+"/60")},showError:function(e){$("#error .modal-body").html(e);$("#error").modal("show")},render:function(){for(var e=0;e<10;e++){this.$layout.append("<div id = 'row"+e+"' class='row span7'></div>");for(var t=0;t<6;t++)$("#row"+e).append("<div class='layout-square off' data-row='"+e+"' data-column='"+t+"'></div>")}},renderQuiz:function(){$("#notes").empty();$("#notes").show();$("#controls").show();$("#form, .tab-content").hide();var e=[],t;this.pickedKeys=MadMinuteUtlities.getKeys();var n=function(e,t,n){this.note=e;this.clef=t;this.key=n};$("#notes").prepend("<div>Date:_<span style='text-decoration: underline'>"+moment().startOf("day").format("MM/DD/YYYY")+"</span>_</div>");$("#notes").prepend("<div>Name:_____________</div>");var r=0;for(var i=0;i<60;i++){var s=$(".layout-square").eq(i).attr("class").split(" "),o=s[1];switch(o){case"trebleShade":o="treble";break;case"bassShade":o="bass";break;case"altoShade":o="alto";break;case"tenorShade":o="tenor";break;case"off":r++}var u=MadMinuteUtlities.getNote(o);if(u===undefined)u=null;else{noted=u.split("");u=u[0]+"/"+u[1]}t=this.pickedKeys[Math.floor(Math.random()*MadMinute.pickedKeys.length)];var a=new n(u,o,t);e.push(a)}var f=60-r;$("#notes").append("<div>___ / "+f+"</div>");for(var i=0;i<60;i++){(i===5||i===11||i===16||i===21||i===45||i===54||i===63||i===72||i===81||i===90)&&$("#notes").append('<div class="clear"></div>');$("#notes").append('<div id="note'+i+'" class="qnote"><canvas style="width: 300px;"></canvas>');if(e[i].note!==null){var l=$("#note"+i+" canvas")[0],c=new Vex.Flow.Renderer(l,Vex.Flow.Renderer.Backends.CANVAS),h=c.getContext(),p=new Vex.Flow.Stave(10,0,140);p.addClef(e[i].clef).addKeySignature(e[i].key).setContext(h).draw();var d=[(new Vex.Flow.StaveNote({clef:e[i].clef,keys:[e[i].note],duration:"w"})).setStemDirection()],v=new Vex.Flow.Voice({num_beats:4,beat_value:4,resolution:Vex.Flow.RESOLUTION});v.addTickables(d);var m=(new Vex.Flow.Formatter).joinVoices([v]).format([v],300);v.draw(h,p)}}}};$(document).ready(function(){$(".nav a").click(function(e){e.preventDefault();$(this).tab("show")});MadMinute.init()});